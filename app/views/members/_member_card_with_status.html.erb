<%
  colors = @family.theme_colors
  status = member.display_status
  is_current_user = member.user_id == current_user.id
%>

<div class="flex flex-col items-center text-center bg-white shadow rounded-lg p-4 hover:shadow-lg transition border relative" style="border-color: <%= colors[:secondary] %>;">
  <!-- Status Badge -->
  <div class="absolute top-2 right-2">
    <% if is_current_user %>
      <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
        You
      </span>
    <% elsif status == 'admin_parent' %>
      <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800">
        Admin
      </span>
    <% elsif status == 'joined' %>
      <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
        Joined
      </span>
    <% elsif status == 'pending' %>
      <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
        Pending
      </span>
    <% elsif status == 'not_invited' && member.can_have_account? %>
      <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-600">
        Not Invited
      </span>
    <% end %>
  </div>

  <%= link_to family_member_path(@family, member), class: "block hover:no-underline w-full" do %>
    <!-- Profile Circle Placeholder -->
    <div class="w-20 h-20 rounded-full flex items-center justify-center text-xl font-semibold mb-3 mx-auto"
         style="background-color: <%= colors[:background] %>; color: <%= colors[:primary] %>;">
      <%= member.name[0].upcase %>
    </div>

    <!-- Name & Role -->
    <div>
      <h3 class="text-lg font-bold" style="color: <%= colors[:primary] %>"><%= member.name %></h3>
      <% if member.age.present? %>
        <p class="text-sm text-gray-600">Age: <%= member.age %></p>
      <% end %>
      <p class="text-xs font-medium mt-1" style="color: <%= colors[:secondary] %>">
        <%= member.display_role %>
      </p>
    </div>
  <% end %>

  <!-- Invite/Resend Button -->
  <% if member.can_have_account? && !member.joined? && !is_current_user %>
    <div class="mt-3 w-full">
      <% if member.invited? %>
        <%= button_to resend_invite_family_member_path(@family, member),
            method: :post,
            class: "w-full text-sm px-3 py-1.5 rounded border transition-all duration-300",
            style: "border-color: #{colors[:primary]}; color: #{colors[:primary]};",
            data: { confirm: "Resend invitation to #{member.email}?" } do %>
          Resend Invite
        <% end %>
      <% elsif member.email.present? %>
        <%= button_to invite_family_member_path(@family, member),
            method: :post,
            class: "w-full text-sm px-3 py-1.5 rounded transition-all duration-300",
            style: "background-color: #{colors[:primary]}; color: white;" do %>
          Send Invite
        <% end %>
      <% else %>
        <%= link_to edit_family_member_path(@family, member),
            class: "block w-full text-sm px-3 py-1.5 rounded border text-center transition-all duration-300",
            style: "border-color: #{colors[:secondary]}; color: #{colors[:secondary]};" do %>
          Add Email to Invite
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>
