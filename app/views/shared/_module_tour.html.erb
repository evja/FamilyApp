<%#
  Module Tour Modal - First-visit guided tour for each module

  Local variables:
    module_key: String - Unique key for the module (e.g., 'issues', 'rhythms')
    icon: String - Lucide icon name (e.g., 'alert-circle', 'repeat')
    title: String - Tour title (e.g., 'Capture Family Challenges')
    purpose: String - Why this module matters (1-2 sentences)
    key_action: String - What the user should do
    cta_text: String - Button text (e.g., 'Log Your First Issue')
    cta_path: Path (optional) - Where the CTA button goes
%>

<% unless session[:completed_tours]&.include?(module_key) %>
  <%
    colors = @family&.theme_colors || { primary: '#2563eb', background: '#eff6ff' }
  %>

  <div data-controller="tour-modal"
       data-tour-modal-module-value="<%= module_key %>"
       class="fixed inset-0 z-50 flex items-center justify-center p-4">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"
         data-action="click->tour-modal#dismiss"></div>

    <!-- Modal content -->
    <div class="relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 text-center transform"
         onclick="event.stopPropagation()">

      <!-- Icon -->
      <div class="w-16 h-16 rounded-full mx-auto mb-6 flex items-center justify-center"
           style="background-color: <%= colors[:background] %>;">
        <% case icon %>
        <% when 'alert-circle' %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: <%= colors[:primary] %>;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        <% when 'heart' %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: <%= colors[:primary] %>;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
          </svg>
        <% when 'repeat' %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: <%= colors[:primary] %>;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
        <% when 'eye' %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: <%= colors[:primary] %>;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg>
        <% when 'check-square' %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: <%= colors[:primary] %>;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
          </svg>
        <% when 'mountain' %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: <%= colors[:primary] %>;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
          </svg>
        <% else %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: <%= colors[:primary] %>;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        <% end %>
      </div>

      <!-- Title -->
      <h2 class="text-2xl font-bold mb-3" style="color: <%= colors[:primary] %>;">
        <%= title %>
      </h2>

      <!-- Purpose -->
      <p class="text-gray-600 mb-4 leading-relaxed">
        <%= purpose %>
      </p>

      <!-- Key Action -->
      <div class="bg-gray-50 rounded-lg px-4 py-3 mb-6">
        <p class="text-sm text-gray-500 uppercase tracking-wide mb-1">Your first step</p>
        <p class="font-medium text-gray-800"><%= key_action %></p>
      </div>

      <!-- Actions -->
      <div class="flex flex-col gap-3">
        <% if local_assigns[:cta_path] && cta_path.present? %>
          <%= link_to cta_text, cta_path,
              class: "w-full px-6 py-3 rounded-lg font-medium text-white transition-all hover:shadow-md",
              style: "background-color: #{colors[:primary]};",
              data: { action: "click->tour-modal#dismiss" } %>
        <% end %>

        <button type="button"
                data-action="click->tour-modal#dismiss"
                class="w-full px-6 py-3 rounded-lg font-medium border-2 transition-all hover:bg-gray-50"
                style="border-color: <%= colors[:primary] %>; color: <%= colors[:primary] %>;">
          Got it
        </button>
      </div>
    </div>
  </div>
<% end %>
